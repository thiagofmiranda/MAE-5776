---
title: "MAE5776 - 1º Sem/2022 – Comparação de 2 Populações Np"
output:
  pdf_document:
    latex_engine: lualatex
    pandoc_args: --listings
    includes:
      in_header: preamble.tex
geometry: columnsep=3em
---

```{r setup, include=FALSE}
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\n \\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
knitr::opts_chunk$set(
  echo = FALSE,
  warning=FALSE,
  message=FALSE, 
  comment=">",
  prompt=T,
  fig.align='center',
  size="small")

options(
  scipen=999,
  knitr.kable.NA = '',
  knitr.table.bottomrule = "\\specialrule{.5pt}{0pt}{1pt}\\specialrule{.5pt}{0pt}{1pt}",
  knitr.table.toprule    = "\\specialrule{.5pt}{0pt}{1pt}\\specialrule{.5pt}{0pt}{1pt}",
  knitr.table.midrule    = "\\specialrule{.4pt}{0pt}{1pt}")


library(kableExtra)
library(tidyverse)
library(GGally)
library(ggpubr)
library(biotools)
library(formatR)
library(xtable)

# Funções

# função para converter uma matrix em tex
texMatrix <- function(matrix, round = 2){
  matrix <- round(matrix,round)
  tex <- ""
  for(i in 1:nrow(matrix)){
    if(i != nrow(matrix)){
      tex <- paste0(tex,paste(matrix[i,],collapse = " & ")," \\\\ ")
    }else{
      tex <- paste0(tex,paste(matrix[i,],collapse = " & "))
    }
    
  }
  
  paste0("\\begin{pmatrix}",tex,"\\end{pmatrix}")
}
```

1 - Comparação de vetores de Médias de 2 populações N3. Teste T2 de Hotelling.

Gerar uma amostra aleatória de $n_{g}$ observações de duas populações Normais tridimensionais, $N_{3}(\mu_{g}; \Sigma_{g})$, envolvendo as variáveis Y1, Y2 e Y3. Preencha a tabela a seguir com os parâmetros adotados na simulação dos dados.

```{r Q1 - Simulação}
# Vetor de médias
media_pop_1 <- c(5.0, 5.7, 5.5)
media_pop_2 <- c(5.8, 5.1, 5.7)

# Matrizes de covariâncias
cov_pop_1 <- matrix(c(1, 0.3, 0.5, 
                      0.3, 0.9, 0.2,
                      0.5, 0.2, 1.1),3,3,byrow=T)
cov_pop_2 <- matrix(c(1, 0.3, 0.5, 
                      0.3, 0.9, 0.2,
                      0.5, 0.2, 1.1),3,3,byrow=T)

# Matrizes de correlações
cor_pop_1 <- matrix(
  c(cov_pop_2[1,1]/(sqrt(cov_pop_2[1,1])*sqrt(cov_pop_2[1,1])),
    cov_pop_2[1,2]/(sqrt(cov_pop_2[1,1])*sqrt(cov_pop_2[2,2])),
    cov_pop_2[1,3]/(sqrt(cov_pop_2[1,1])*sqrt(cov_pop_2[3,3])),
    cov_pop_2[2,1]/(sqrt(cov_pop_2[2,2])*sqrt(cov_pop_2[1,1])),
    cov_pop_2[2,2]/(sqrt(cov_pop_2[2,2])*sqrt(cov_pop_2[2,2])),
    cov_pop_2[2,3]/(sqrt(cov_pop_2[2,2])*sqrt(cov_pop_2[3,3])),
    cov_pop_2[3,1]/(sqrt(cov_pop_2[3,3])*sqrt(cov_pop_2[1,1])),
    cov_pop_2[3,2]/(sqrt(cov_pop_2[3,3])*sqrt(cov_pop_2[2,2])),
    cov_pop_2[3,3]/(sqrt(cov_pop_2[3,3])*sqrt(cov_pop_2[3,3]))),
  3,3,byrow=T) 

cor_pop_2 <- matrix(
  c(cov_pop_2[1,1]/(sqrt(cov_pop_2[1,1])*sqrt(cov_pop_2[1,1])),
    cov_pop_2[1,2]/(sqrt(cov_pop_2[1,1])*sqrt(cov_pop_2[2,2])),
    cov_pop_2[1,3]/(sqrt(cov_pop_2[1,1])*sqrt(cov_pop_2[3,3])),
    cov_pop_2[2,1]/(sqrt(cov_pop_2[2,2])*sqrt(cov_pop_2[1,1])),
    cov_pop_2[2,2]/(sqrt(cov_pop_2[2,2])*sqrt(cov_pop_2[2,2])),
    cov_pop_2[2,3]/(sqrt(cov_pop_2[2,2])*sqrt(cov_pop_2[3,3])),
    cov_pop_2[3,1]/(sqrt(cov_pop_2[3,3])*sqrt(cov_pop_2[1,1])),
    cov_pop_2[3,2]/(sqrt(cov_pop_2[3,3])*sqrt(cov_pop_2[2,2])),
    cov_pop_2[3,3]/(sqrt(cov_pop_2[3,3])*sqrt(cov_pop_2[3,3]))),
  3,3,byrow=T)


# Simulação dos dados
set.seed(123)
pop_1 <- MASS::mvrnorm(100,media_pop_1,cov_pop_1) |> 
  as_tibble() |> 
  mutate(Pop = "Escola 1")

pop_2 <- MASS::mvrnorm(100,media_pop_2,cov_pop_2) |> 
  as_tibble() |> 
  mutate(Pop = "Escola 2")

pop <- bind_rows(pop_1, pop_2) |> 
  rename(Por = V1, Mat = V2, His = V3)

# outputs para a tabela em latex
media_pop_1_tex <- paste0("$\\mu_{1}=(",paste(media_pop_1,collapse = ", "),")$")
media_pop_2_tex <- paste0("$\\mu_{2}=(",paste(media_pop_2,collapse = ", "),")$")

cov_pop_1_tex <- paste0("$\\Sigma_{1}=",texMatrix(cov_pop_1),"$")
cov_pop_2_tex <- paste0("$\\Sigma_{2}=",texMatrix(cov_pop_2),"$")

cor_pop_1_tex <- paste0("$\\rho_{1}=",texMatrix(cor_pop_1),"$")
cor_pop_2_tex <- paste0("$\\rho_{2}=",texMatrix(cor_pop_2),"$")


# Tabela resumo
tb_1 <- tibble(
  População = c("Pop 1","Pop 2"),
  Amostra = c("$n_{1}=100$","$n_{2}=100$"),
  `Vetor de Médias` = c(media_pop_1_tex, media_pop_2_tex),
  `Matriz de Covariâncias` = c(cov_pop_1_tex,cov_pop_2_tex),
  `Matriz de Correlações` = c(cor_pop_1_tex,cor_pop_2_tex)
  )

# Exibindo tabela resumo
tb_1 |>
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=8) 


```

1.1 - Contextualize, com uma situação prática hipotética, os dados gerados. Caracterize a estrutura dos dados (amostras balanceadas, observações independentes, tipo de variável, dimensão dos dados, etc). Defina o objetivo do estudo.

R: Podemos contextualizar os dados com sendo de notas de português, matemática e história de turmas do 3º ano do ensino médio de duas escolas de São Paulo avaliadas pela teoria da resposta ao item. De um modo geral, os dados são compostos por 3 variáveis contínuas com um total de 200 observações e uma variável categórica definindo a população da amostra. São dados balanceados, contendo 100 obsevações em cada amostra e foram gerados de forma independente, onde a geração de cada observação não influenciou as demais. O objetivo desse estudo será comparar as notas médias das 3 disciplinas entre ambas as escolas.

\pagebreak

1.2 - Realize uma análise descritiva dos dados (calcule estatísticas descritivas, construa gráficos apropriados). Comente os resultados de acordo com o objetivo do estudo.

```{r Q1 - Descritivas, out.width = '80%',}

media_amostra_1 <- colMeans(pop[pop$Pop == "Escola 1", -4])
media_amostra_2 <- colMeans(pop[pop$Pop == "Escola 2", -4])

cov_amostra_1 <- cov(pop[pop$Pop == "Escola 1", -4])
cov_amostra_2 <- cov(pop[pop$Pop == "Escola 2", -4])

cor_amostra_1 <- cor(pop[pop$Pop == "Escola 1", -4])
cor_amostra_2 <- cor(pop[pop$Pop == "Escola 2", -4])

# outputs para a tabela em latex
media_amostra_1_tex <- paste0("$\\bar{Y_{1}}=(",paste(round(media_amostra_1,2),collapse = ", "),")$")
media_amostra_2_tex <- paste0("$\\bar{Y_{2}}=(",paste(round(media_amostra_2,2),collapse = ", "),")$")

cov_amostra_1_tex <- paste0("$S_{u1}=",texMatrix(cov_amostra_1),"$")
cov_amostra_2_tex <- paste0("$S_{u2}=",texMatrix(cov_amostra_2),"$")

cor_amostra_1_tex <- paste0("$R_{1}=",texMatrix(cor_amostra_1),"$")
cor_amostra_2_tex <- paste0("$R_{2}=",texMatrix(cor_amostra_2),"$")

# Tabela resumo
tb_2 <- tibble(
  População = c("Escola 1","Escola 2"),
  Amostra = c("$n_{1}=100$","$n_{2}=100$"),
  `Vetor de Médias` = c(media_amostra_1_tex, media_amostra_2_tex),
  `Matriz de Covariâncias` = c(cov_amostra_1_tex,cov_amostra_2_tex),
  `Matriz de Correlações` = c(cor_amostra_1_tex,cor_amostra_2_tex)
  )

# Exibindo tabela resumo
tb_2 |>
  kbl(format = "latex",
      escape = FALSE,
      booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=8)

ggpairs(pop, ggplot2::aes(colour=Pop)) 

```

R: Ao observar os box plots de cada disciplina da Escola 1 e Escola 2 percebe que as medianas não estão distantes; ao observar os histogramas percebe-se que as distribuições da notas em cada disciplina são parecidas; os gráficos de dispersão apontam que há uma marcante intercepção entre as notas da mesma disciplina em Escolas diferentes; a distancia entre as médias de uma mesma disciplina na Escola 1 e Escola 2 são inferiores a 1; os centroides não parecem estar distantes; e as matrizes de covariância e correlação não apontam alta dependência entre as notas das disciplinas tanto para a Escola 1 quanto para a Escola 2, exceto para a relação entre as notas de Português e História.

\pagebreak

1.3 - De acordo com as premissas adotadas na simulação dos dados, qual é a distribuição amostral da estatística $\bar{\bar{Y_{1}}} - \bar{\bar{Y_{2}}}$? Justifique. Com base nos dados simulados, construa um gráfico de quantis da Normal para validar os resultados.

R: Os dados foram simulados com base em duas normais multivariadas, a estatística $\bar{\bar{Y_{1}}} - \bar{\bar{Y_{2}}}$ terá como distribuição amostral uma normal multivariada, pois qualquer combinação linear entre distribuições normais multivariadas resultará em uma distribuição normal multivariada. Verificaremos se cada amostra tem distribuição normal multivariada, para tal, avaliaremos se soma das notas de português, matemática e história seguem um distribuição normal.

Hipóteses para a amostra da Escola 1:
$$H_{0}: Por_{1} + Mat_{1} + His_{1} \sim N(\mu_{1}, \sigma^2_{1})$$
$$H_{1}: Por_{1} + Mat_{1} + His_{1} \nsim N(\mu_{1}, \sigma^2_{1})$$

```{r Q1 - QQplot amostra 1,out.width = '40%'}
Amostra_1 <- pop |> 
  filter(Pop=="Escola 1") |> 
  mutate(PMH = Por + Mat + His)

ggqqplot(Amostra_1, x = "PMH")
```

Hipóteses para a amostra da Escola 2:

$$H_{0}: Por_{2} + Mat_{2} + His_{2} \sim N(\mu_{2}, \sigma^2_{2})$$

$$H_{1}: Por_{2} + Mat_{2} + His_{2} \nsim N(\mu_{2}, \sigma^2_{2})$$

```{r Q1 - QQplot amostra 2,out.width = '40%'}
Amostra_2 <- pop |> 
  filter(Pop=="Escola 2") |> 
  mutate(PMH = Por + Mat + His)

ggqqplot(Amostra_2, x = "PMH")
```

A partir dos QQ-plots apresentados, verificamos que as soma das variáveis nas duas escolas têm distribuições amostrais normais, evidenciando que, conjutamente, cada escola tem distribuição amostral normal multivariada nas notas de português, matemática e história. Consequentemente, $\bar{\bar{Y_{1}}} - \bar{\bar{Y_{2}}}$ também resultará em uma $N(\mu_{1}-\mu_{2}, \sigma^2_{1}-\sigma^2_{2})$. 

1.4 - Há evidência amostral de diferença significante entre os vetores de Médias das duas populações? Justifique.

R: 

```{r Q1 - Teste M de Box, echo=FALSE}
teste_boxM <- boxM(data = pop[,-4], grouping = pop$Pop) 
teste_boxM
```

Como o p-valor de `r round(teste_boxM$p.value,4)` é maior que o nível de significância de 5%. Não rejeitamos a hipótese nula de que as matrizes de covariâncias são iguais.

```{r  Q1 - Teste de Hotelling, echo=FALSE}
library(Hotelling)
teste_t2_hotelling <- hotelling.test(pop[pop$Pop=="Escola 1",-4],pop[pop$Pop=="Escola 2",-4], var.equal = TRUE)
teste_t2_hotelling
```

De acordo com o teste T de Hotelling, onde o p-value é menor que o nível de significância de 5%, deste modo rejeitamos a hipótese nula e concluímos que há algumas diferença entre as médias das escolas para as disciplinas de português, matemática e história.


1.5 - Para cada variável, compare as médias das duas populações. Utilize correções de Bonferroni e FDR na conclusão dessas comparações. Qual variável mais contribui para a possível diferença entre as populações?

R: 

```{r Q1 - Teste de Médias Por, echo=FALSE}
por_bartlettteste <- bartlett.test(pop$Por ~ pop$Pop) 
por_bartlettteste
por_ttteste <- t.test(pop$Por ~ pop$Pop, conf.level=0.95, var.equal=TRUE)
por_ttteste 
```

Como o p-valor do teste T de `r round(por_bartlettteste$p.value,4)` é maior que o nível de significância de 5%, não rejeitamos a hipóteses nula e concluímos que as variâncias das notas de português entre os grupos são homogêneas. E, como o p-valor do teste T de `r round(por_ttteste$p.value,4)` é menor que o nível de significância de 5%, rejeitamos a hipóteses nula e concluímos que as médias das notas de português entre as escolas 1 e 2 são diferentes, ao nível de 95% de confiança. 


```{r Q1 - Teste de Médias Mat, echo=FALSE}
mat_bartlettteste <- bartlett.test(pop$Mat ~ pop$Pop) 
mat_bartlettteste
mat_ttteste <- t.test(pop$Mat ~ pop$Pop,conf.level=0.95,var.equal=TRUE)
mat_ttteste
```

Como o p-valor do teste T de `r round(mat_bartlettteste$p.value,4)` é maior que o nível de significância de 5%, não rejeitamos a hipóteses nula e concluímos que as variâncias das notas de matemática entre os grupos são homogêneas. E, como o p-valor do teste T de `r round(mat_ttteste$p.value,4)` é menor que o nível de significância de 5%, rejeitamos a hipóteses nula e concluímos que as médias das notas de matemática entre as escolas 1 e 2 são diferentes, ao nível de 95% de confiança. 

```{r  Q1 - Teste de Médias His, echo=FALSE}
his_bartlettteste <- bartlett.test(pop$His ~ pop$Pop) 
his_bartlettteste
his_ttteste <- t.test(pop$His ~ pop$Pop,conf.level=0.95,var.equal=TRUE)
his_ttteste
```

Como o p-valor do teste T de `r round(his_bartlettteste$p.value,4)` é maior que o nível de significância de 5%, não rejeitamos a hipóteses nula e concluímos que as variâncias das notas de história entre os grupos são homogêneas. E, como o p-valor do teste T de `r round(his_ttteste$p.value,4)` é menor que o nível de significância de 5%, rejeitamos a hipóteses nula e concluímos que as médias das notas de história entre as escolas 1 e 2 são diferentes, ao nível de 95% de confiança.

```{r Q1 - Ajustes no P-Valor}
#Obter os p-valores (bicaudal) individuais com correção para múltiplos testes
p.result <- c(por_ttteste$p.value,mat_ttteste$p.value,his_ttteste$p.value)

padjustB <- p.adjust(p.result,method="bonferroni")
padjustFDR <- p.adjust(p.result,method="fdr")

padjusts <- tibble(Disciplina=c("Por","Mat","His")) |> 
  mutate(p.result = round(p.result,6)) |> 
  mutate(padjustB = round(padjustB,6)) |> 
  mutate(padjustFDR = round(padjustFDR,6))

padjusts |>
  kbl(format = "latex",
      escape = FALSE,
      booktabs = TRUE,longtable = T)
```

Mesmo considerando as correções de Boferroni e FDR, percebemos que há diferença significativa entre as médias de cada variável nas duas amostras (Escola 1 e Escola 2).

\pagebreak

2 - Comparação de vetores de Médias de Normais tridimensionais, $N_{3}$, em Delineamentos Completamente Aleatorizados com Estrutura Fatorial Cruzado 2x2 - MANOVA

Gerar dados da N3 de acordo com um Delineamento Completamente Aleatorizado (DCA) Fatorial Cruzado 2x2. Considerando os Fatores F1 e F2, cada um em dois níveis, 0 e 1, preencha a tabela a seguir com os parâmetros adotados na simulação dos dados.

```{r Q2 - Parâmetros}
media_pop_1 <- c(12, 15, 23)
media_pop_2 <- c(13, 15, 22)
media_pop_3 <- c(9, 14, 18)
media_pop_4 <- c(13, 17, 26)

cov_pop <- matrix(c(3, 1.2, 1.9, 
                    1.2, 2, 1.5,
                    1.9, 1.5, 3),3,3,byrow=T)

# outputs para a tabela em latex
media_pop_1_tex <- paste0("$\\mu_{1,0}=(",paste(media_pop_1,collapse = ", "),"),"," \\Sigma_{1,0}=",texMatrix(cov_pop),"$")
media_pop_2_tex <- paste0("$\\mu_{1,1}=(",paste(media_pop_2,collapse = ", "),"),"," \\Sigma_{1,1}=",texMatrix(cov_pop),"$")
media_pop_3_tex <- paste0("$\\mu_{0,0}=(",paste(media_pop_3,collapse = ", "),"),"," \\Sigma_{0,0}=",texMatrix(cov_pop),"$")
media_pop_4_tex <- paste0("$\\mu_{0,1}=(",paste(media_pop_4,collapse = ", "),"),"," \\Sigma_{0,1}=",texMatrix(cov_pop),"$")

cov_pop_tex <- paste0("$\\Sigma_{1}=",texMatrix(cov_pop),"$")

# Tabela resumo
tb_2 <- tibble(
  `Fator 1` = c(0, 1),
  `0` = c(media_pop_3_tex, media_pop_1_tex),
  `1` = c(media_pop_4_tex, media_pop_2_tex),
  )

tb_2 |>
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T,align="c") |> 
  kable_styling(font_size=8) |> 
  add_header_above(c(" " = 1, "Fator 2" = 2),align = "c")
```


```{r Q2 - Simulação}
cor_pop <- matrix(
  c(cov_pop[1,1]/(sqrt(cov_pop[1,1])*sqrt(cov_pop[1,1])),
    cov_pop[1,2]/(sqrt(cov_pop[1,1])*sqrt(cov_pop[2,2])),
    cov_pop[1,3]/(sqrt(cov_pop[1,1])*sqrt(cov_pop[3,3])),
    cov_pop[2,1]/(sqrt(cov_pop[2,2])*sqrt(cov_pop[1,1])),
    cov_pop[2,2]/(sqrt(cov_pop[2,2])*sqrt(cov_pop[2,2])),
    cov_pop[2,3]/(sqrt(cov_pop[2,2])*sqrt(cov_pop[3,3])),
    cov_pop[3,1]/(sqrt(cov_pop[3,3])*sqrt(cov_pop[1,1])),
    cov_pop[3,2]/(sqrt(cov_pop[3,3])*sqrt(cov_pop[2,2])),
    cov_pop[3,3]/(sqrt(cov_pop[3,3])*sqrt(cov_pop[3,3]))),
  3,3,byrow=T)

set.seed(123)
pop_1 <- MASS::mvrnorm(12,media_pop_1,cov_pop) |> 
  as_tibble() |>
  mutate(F1 = 1,F2 = 0)
pop_2 <- MASS::mvrnorm(12,media_pop_2,cov_pop) |> 
  as_tibble() |>
  mutate(F1 = 1,F2 = 1)
pop_3 <- MASS::mvrnorm(12,media_pop_3,cov_pop) |> 
  as_tibble() |>
  mutate(F1 = 0,F2 = 0)
pop_4 <- MASS::mvrnorm(12,media_pop_4,cov_pop) |> 
  as_tibble() |>
  mutate(F1 = 0,F2 = 1)

pop <- bind_rows(pop_1, pop_2, pop_3, pop_4) |> 
  rename(uva = V1, banana = V2, laranja = V3)
```

2.1 - Contextualize, com uma situação prática hipotética, os dados gerados. Caracterize a estrutura dos dados e defina o objetivo do estudo.

R: Os dados são referentes a um experimento fatorial 2x2, onde averiguou-se a produção, em toneladas por hectare, de três tipos de frutas (uva, banana e laranja) sob o efeito de dois tipos de adubos F1 e F2, que serão avaliados em dois níveis (1 - presente; 0 - ausente), sendo que o objetivo é verificar se o uso dos adubos F1 e F2 têm (ou não) efeito significativo sobre a produção das três frutas.

\newpage

2.2 - Realize uma análise descritiva dos dados (calcule estatísticas descritivas, construa gráficos apropriados). Comente os resultados de acordo com o objetivo do estudo.

R: Os gráficos de dispersão relacionados ao Fator 1 apontam que há marcante intersecção entre os valores obtidos na produção de banana, laranja e uva, ao avaliar se há correlação comparando dois a dois, daí vemos que os pontos se sobrepõe, o que demonstra não haver clara "distinção" entre a produção de cada fruta, tendo em vista a aplicação do fator F1. Comportamento similar é percebido quando na aplicação do fator F2. Os box plot obtidos com o fator F1 apontam que para a produção de uva medianamente há pouco distinção entre a aplicar ou não o fator F1, bem como para a produção de banana e laranja. Contudo, notamos que a dispersão (variabilidade dos dados) é maior quando o fator F1 está no nível "0". Comportamento similar é percebido para o fator F2, no que tange aos valores medianos (não são muito distantes) ao aplicar ou não o fator 2 na produção das frutas. Contudo, notamos que a dispersão (variabilidade dos dados) é maior quando o fator F1 está no nível "0"para a produção de uva e laranja.

```{r Q2 - Gráficos,out.width = '60%'}
pop |>
  mutate(F1 = as.factor(F1)) |>
  dplyr::select(-F2) |>
  ggpairs(ggplot2::aes(colour=F1),title = "Descritivas para F1")+
  scale_fill_manual(values = c("#2a9d8f","#264653"))+
  scale_color_manual(values = c("#2a9d8f","#264653"))

pop |>
  mutate(F2 = as.factor(F2)) |>
  dplyr::select(-F1) |>
  ggpairs(ggplot2::aes(colour=F2),title = "Descritivas para F2")+
  scale_fill_manual(values = c("#457b9d","#1d3557"))+
  scale_color_manual(values = c("#457b9d","#1d3557"))
```

Ao avaliar (graficamente) o efeito de interação entre os fatores, percebe-se que há interação significativa na produção de banana e laranja, já na produção de uva não há evidência de interação significativa do uso dos adubos F1 e F2 (ou seja, F1*F2 é significativo apenas na produção de banana e laranja).

```{r Q2 - Descritivas, ,out.width = '80%'}
media_amostra_1 <- colMeans(pop[pop$F1==1 & pop$F2==0, -c(4,5)])
media_amostra_2 <- colMeans(pop[pop$F1==1 & pop$F2==1, -c(4,5)])
media_amostra_3 <- colMeans(pop[pop$F1==0 & pop$F2==0, -c(4,5)])
media_amostra_4 <- colMeans(pop[pop$F1==0 & pop$F2==1, -c(4,5)])

cov_amostra_1 <- cov(pop[pop$F1==1 & pop$F2==0, -c(4,5)])
cov_amostra_2 <- cov(pop[pop$F1==1 & pop$F2==1, -c(4,5)])
cov_amostra_3 <- cov(pop[pop$F1==0 & pop$F2==0, -c(4,5)])
cov_amostra_4 <- cov(pop[pop$F1==0 & pop$F2==1, -c(4,5)])

cor_amostra_1 <- cor(pop[pop$F1==1 & pop$F2==0, -c(4,5)])
cor_amostra_2 <- cor(pop[pop$F1==1 & pop$F2==1, -c(4,5)])
cor_amostra_3 <- cor(pop[pop$F1==0 & pop$F2==0, -c(4,5)])
cor_amostra_4 <- cor(pop[pop$F1==0 & pop$F2==1, -c(4,5)])

# outputs para a tabela em latex
media_amostra_1_tex <- paste0("$\\bar{Y}_{1,0}=(",paste(round(media_amostra_1,2),collapse = ", "),")$")
media_amostra_2_tex <- paste0("$\\bar{Y}_{1,1}=(",paste(round(media_amostra_2,2),collapse = ", "),")$")
media_amostra_3_tex <- paste0("$\\bar{Y}_{0,0}=(",paste(round(media_amostra_3,2),collapse = ", "),")$")
media_amostra_4_tex <- paste0("$\\bar{Y}_{0,1}=(",paste(round(media_amostra_4,2),collapse = ", "),")$")

cov_amostra_1_tex <- paste0("$S_{1,0}=",texMatrix(cov_amostra_1),"$")
cov_amostra_2_tex <- paste0("$S_{1,1}=",texMatrix(cov_amostra_2),"$")
cov_amostra_3_tex <- paste0("$S_{0,0}=",texMatrix(cov_amostra_3),"$")
cov_amostra_4_tex <- paste0("$S_{0,1}=",texMatrix(cov_amostra_4),"$")

cor_amostra_1_tex <- paste0("$R_{1,0}=",texMatrix(cor_amostra_1),"$")
cor_amostra_2_tex <- paste0("$R_{1,1}=",texMatrix(cor_amostra_2),"$")
cor_amostra_3_tex <- paste0("$R_{0,0}=",texMatrix(cor_amostra_3),"$")
cor_amostra_4_tex <- paste0("$R_{1,1}=",texMatrix(cor_amostra_4),"$")

# Tabelas resumo
tibble(
  `Fator 1` = c(0, 1),
  `0` = c(media_amostra_3_tex, media_amostra_1_tex),
  `1` = c(media_amostra_4_tex, media_amostra_2_tex))|>
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T,align="c") |>  
  kable_styling(font_size=6) |> 
  add_header_above(c(" " = 1, "Fator 2" = 2),align = "c")

tibble(
  `Fator 1` = c(0, 1),
  `0` = c(cov_amostra_3_tex, cov_amostra_1_tex),
  `1` = c(cov_amostra_4_tex, cov_amostra_2_tex))|>
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T,align="c") |> 
  kable_styling(font_size=6) |> 
  add_header_above(c(" " = 1, "Fator 2" = 2),align = "c")

tibble(
  `Fator 1` = c(0, 1),
  `0` = c(cor_amostra_3_tex, cor_amostra_1_tex),
  `1` = c(cor_amostra_4_tex, cor_amostra_2_tex))|>
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T,align="c") |>  
  kable_styling(font_size=6) |> 
  add_header_above(c(" " = 1, "Fator 2" = 2),align = "c")

pop |> 
  gather(fruta, quilos,-F1,-F2) |> 
  mutate(F1 = as.factor(F1)) |> 
  mutate(F2 = as.factor(F2)) |> 
  ggplot(aes(x = F1 , color = F2 , group = F2 , y = quilos )) +
  stat_summary(fun = mean, geom = "point") +
  stat_summary(fun = mean, geom = "line") +
  facet_wrap(~fruta,scales = "free_y") +
  ggtitle("Perfis de Médias-Interação")
```

\pagebreak

2.3 - Construa a Tabela de MANOVA para a análise destes dados. Considere as fontes de variação devido aos efeitos principais dos fatores F1 e F2 e sua interação $F1*F2$, os correspondentes números de graus de liberdade e as Somas de Quadrados e Produtos Cruzados ($SS_{F1}$, $SS_{F2}$, e $SS_{F1*F2}$, bem como $SS_{W}$). Há evidência amostral de efeito significante dos fatores sob estudo?

R: Para a construção da tabela MANOVA, primeiramente, foi avaliado a homogeneidade entre as matrizes de covariâncias com o Teste M de Box. 

```{r Q2 - Teste M de Box}
teste_boxM <- boxM(pop[,1:3],as.factor(pop$F2))
teste_boxM
```

Como o p-valor de `r round(teste_boxM$p.value,4)` é maior que o nível de significância de 5%. Não rejeitamos a hipótese nula de que as matrizes de covariâncias são iguais. Prosseguimos com a MANOVA:


```{r Q2 - MANOVA}
fit <- manova(as.matrix(pop[,1:3]) ~ pop$F1 + pop$F2 + pop$F1*pop$F2)

options(scipen=0)
fit

fit_sum_p <- summary(fit,test = "Pillai")
fit_sum_w <- summary(fit,test = "Wilks")

tibble(` `=str_remove_all(fit_sum_p$row.names,"pop\\$")) |> 
  bind_cols(as_tibble(fit_sum_p$stats)) |> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)

tibble(` `=str_remove_all(fit_sum_w$row.names,"pop\\$")) |> 
  bind_cols(as_tibble(fit_sum_w$stats)) |> 
  as_tibble() |> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)

options(scipen=999)
```

Como os p-valores pelos teste de Wilks e Pillai de F1 são menores que o nível de significância de 5%. Rejeitamos a hipótese nula e concluímos que há diferença no vetor médias quando há aplicação do adubo F1.

```{r}
pop |> 
  group_by(F1) |> 
  dplyr::summarise(uva = mean(uva), banana = mean(banana), laranja = mean(laranja)) |> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```

Como os p-valores pelos teste de Wilks e Pillai de F2 são menores que o nível de significância de 5%. Rejeitamos a hipótese nula e concluímos que há diferença no vetor médias quando há aplicação do adubo F2.

```{r}
pop |> 
  group_by(F2) |> 
  dplyr::summarise(uva = mean(uva), banana = mean(banana), laranja = mean(laranja)) |> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```

Como os p-valores pelos teste de Wilks e Pillai para a interação de F1 com F2 são menores que o nível de significância de 5%. Rejeitamos a hipótese nula e concluímos que há diferença no vetor médias quando há combinação dos adubos F1 e F2.

```{r}
pop |> 
  group_by(F1,F2) |> 
  dplyr::summarise(uva = mean(uva), banana = mean(banana), laranja = mean(laranja)) |> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```

```{r Q2 - MANOVA Stats}
SSF1 <- fit_sum_p$SS$`pop$F1`
SSF2 <- fit_sum_p$SS$`pop$F2`
SSF1F2 <- fit_sum_p$SS$`pop$F1:pop$F2`
SSW <- fit_sum_p$SS$Residuals

SSTotal <- SSF1 + SSF2 + SSF1F2 + SSW

SSB <- SSTotal-SSW
```

Somas de Quadrados e Produtos Cruzados $SS_{F1}$:
```{r}
SSF1 |> 
  as_tibble() |> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```

Somas de Quadrados e Produtos Cruzados $SS_{F2}$:
```{r}
SSF2|> 
  as_tibble()|> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```

Somas de Quadrados e Produtos Cruzados $SS_{F1*F2}$:
```{r}
SSF1F2 |> 
  as_tibble()|> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```

Somas de Quadrados e Produtos Cruzados $SS_{F}$:
```{r}
SSB |> 
  as_tibble() |> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```

Somas de Quadrados e Produtos Cruzados $SS_{W}$:
```{r}
SSW |> 
  as_tibble() |> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```

Somas de Quadrados e Produtos Cruzados $SS_{total}$:
```{r}
SSTotal |> 
  as_tibble() |> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```


2.4 - De acordo com os resultados da MANOVA, realize comparações múltiplas para estudar os efeitos significantes dos fatores. Utilize correções de Bonferroni e FDR. Interprete os resultados.

R: [responder]
```{r, echo=FALSE}
bartlett_teste_uva_F1 <- bartlett.test(pop$uva ~ pop$F1) 
bartlett_teste_uva_F2 <- bartlett.test(pop$uva ~ pop$F2)
bartlett_teste_banana_F1 <- bartlett.test(pop$banana ~ pop$F1)
bartlett_teste_banana_F2 <- bartlett.test(pop$banana ~ pop$F2)
bartlett_teste_laranja_F1 <- bartlett.test(pop$laranja ~ pop$F1)
bartlett_teste_laranja_F2 <- bartlett.test(pop$laranja ~ pop$F2)

t_teste_uva_F1 <- t.test(pop$uva ~ pop$F1, conf.level=0.95, var.equal=TRUE) 
t_teste_uva_F2 <- t.test(pop$uva ~ pop$F2, conf.level=0.95, var.equal=TRUE)
t_teste_banana_F1 <- t.test(pop$banana ~ pop$F1, conf.level=0.95, var.equal=FALSE)
t_teste_banana_F2 <- t.test(pop$banana ~ pop$F2, conf.level=0.95, var.equal=TRUE)
t_teste_laranja_F1 <- t.test(pop$laranja ~ pop$F1, conf.level=0.95, var.equal=TRUE)
t_teste_laranja_F2 <- t.test(pop$laranja ~ pop$F2, conf.level=0.95, var.equal=TRUE)


pop_int <- pop |> 
  mutate(F1F2 = paste0(F1,F2)) |> 
  dplyr::select(-F1,-F2)

# F1==0 e F2==1 x F1==0 e F2==0
pop_01_00 <- filter(pop_int,F1F2 %in% c("01","00"))

bartlett_teste_uva_01_00     <- bartlett.test(uva ~ F1F2,     data = pop_01_00) # Homo
bartlett_teste_banana_01_00  <- bartlett.test(banana ~ F1F2,  data = pop_01_00) # Homo
bartlett_teste_laranja_01_00 <- bartlett.test(laranja ~ F1F2, data = pop_01_00) # Homo

t_teste_uva_01_00     <- t.test(uva ~ F1F2,     data = pop_01_00, conf.level=0.95, var.equal=TRUE)
t_teste_banana_01_00  <- t.test(banana ~ F1F2,  data = pop_01_00, conf.level=0.95, var.equal=TRUE)
t_teste_laranja_01_00 <- t.test(laranja ~ F1F2, data = pop_01_00, conf.level=0.95, var.equal=TRUE)


# F1==0 e F2==1 x F1==1 com F2==1
pop_01_11 <- filter(pop_int,F1F2 %in% c("01","11"))

bartlett_teste_uva_01_11     <- bartlett.test(uva ~ F1F2,     data = pop_01_11) # Hete
bartlett_teste_banana_01_11  <- bartlett.test(banana ~ F1F2,  data = pop_01_11) # Homo
bartlett_teste_laranja_01_11 <- bartlett.test(laranja ~ F1F2, data = pop_01_11) # Homo

t_teste_uva_01_11     <- t.test(uva ~ F1F2,     data = pop_01_11, conf.level=0.95, var.equal=FALSE)
t_teste_banana_01_11  <- t.test(banana ~ F1F2,  data = pop_01_11, conf.level=0.95, var.equal=TRUE)
t_teste_laranja_01_11 <- t.test(laranja ~ F1F2, data = pop_01_11, conf.level=0.95, var.equal=TRUE)


# F1==0 e F2==1 x F1==1 com F2==0
pop_01_10 <- filter(pop_int,F1F2 %in% c("01","10"))

bartlett_teste_uva_01_10     <- bartlett.test(uva ~ F1F2,     data = pop_01_10) # Hete
bartlett_teste_banana_01_10  <- bartlett.test(banana ~ F1F2,  data = pop_01_10) # Homo
bartlett_teste_laranja_01_10 <- bartlett.test(laranja ~ F1F2, data = pop_01_10) # Homo

t_teste_uva_01_10     <- t.test(uva ~ F1F2,     data = pop_01_10, conf.level=0.95, var.equal=FALSE)
t_teste_banana_01_10  <- t.test(banana ~ F1F2,  data = pop_01_10, conf.level=0.95, var.equal=TRUE)
t_teste_laranja_01_10 <- t.test(laranja ~ F1F2, data = pop_01_10, conf.level=0.95, var.equal=TRUE)


# F1==0 e F2==0 x F1==1 e F2==1
pop_00_11 <- filter(pop_int,F1F2 %in% c("00","11"))

bartlett_teste_uva_00_11     <- bartlett.test(uva ~ F1F2,     data = pop_00_11) # Homo
bartlett_teste_banana_00_11  <- bartlett.test(banana ~ F1F2,  data = pop_00_11) # Homo
bartlett_teste_laranja_00_11 <- bartlett.test(laranja ~ F1F2, data = pop_00_11) # Homo

t_teste_uva_00_11     <- t.test(uva ~ F1F2,     data = pop_00_11, conf.level=0.95, var.equal=TRUE)
t_teste_banana_00_11  <- t.test(banana ~ F1F2,  data = pop_00_11, conf.level=0.95, var.equal=TRUE)
t_teste_laranja_00_11 <- t.test(laranja ~ F1F2, data = pop_00_11, conf.level=0.95, var.equal=TRUE)


# F1==0 e F2==0 x F1==1 e F2==0
pop_00_10 <- filter(pop_int,F1F2 %in% c("00","10"))

bartlett_teste_uva_00_10     <- bartlett.test(uva ~ F1F2,     data = pop_00_10) # Homo
bartlett_teste_banana_00_10  <- bartlett.test(banana ~ F1F2,  data = pop_00_10) # Homo
bartlett_teste_laranja_00_10 <- bartlett.test(laranja ~ F1F2, data = pop_00_10) # Homo

t_teste_uva_00_10     <- t.test(uva ~ F1F2,     data = pop_00_10, conf.level=0.95, var.equal=TRUE)
t_teste_banana_00_10  <- t.test(banana ~ F1F2,  data = pop_00_10, conf.level=0.95, var.equal=TRUE)
t_teste_laranja_00_10 <- t.test(laranja ~ F1F2, data = pop_00_10, conf.level=0.95, var.equal=TRUE)


# F1==1 e F2==1 x F1==1 e F2==0
pop_11_10 <- filter(pop_int,F1F2 %in% c("11","10"))

bartlett_teste_uva_11_10     <- bartlett.test(uva ~ F1F2,     data = pop_11_10) # Homo
bartlett_teste_banana_11_10  <- bartlett.test(banana ~ F1F2,  data = pop_11_10) # Homo
bartlett_teste_laranja_11_10 <- bartlett.test(laranja ~ F1F2, data = pop_11_10) # Homo

t_teste_uva_11_10     <- t.test(uva ~ F1F2,     data = pop_11_10, conf.level=0.95, var.equal=TRUE)
t_teste_banana_11_10  <- t.test(banana ~ F1F2,  data = pop_11_10, conf.level=0.95, var.equal=TRUE)
t_teste_laranja_11_10 <- t.test(laranja ~ F1F2, data = pop_11_10, conf.level=0.95, var.equal=TRUE)


`P-Valor Teste de Bartlett` = c(
  bartlett_teste_uva_F1$p.value,bartlett_teste_banana_F1$p.value,bartlett_teste_laranja_F1$p.value,
  bartlett_teste_uva_F2$p.value,bartlett_teste_banana_F2$p.value,bartlett_teste_laranja_F2$p.value,
  bartlett_teste_uva_01_00$p.value,bartlett_teste_banana_01_00$p.value,bartlett_teste_laranja_01_00$p.value,
  bartlett_teste_uva_01_11$p.value,bartlett_teste_banana_01_11$p.value,bartlett_teste_laranja_01_11$p.value,
  bartlett_teste_uva_01_10$p.value,bartlett_teste_banana_01_10$p.value,bartlett_teste_laranja_01_10$p.value,
  bartlett_teste_uva_00_11$p.value,bartlett_teste_banana_00_11$p.value,bartlett_teste_laranja_00_11$p.value,
  bartlett_teste_uva_00_10$p.value,bartlett_teste_banana_00_10$p.value,bartlett_teste_laranja_00_10$p.value,
  bartlett_teste_uva_11_10$p.value,bartlett_teste_banana_11_10$p.value,bartlett_teste_laranja_11_10$p.value)

`P-Valor T Test` = c(
  t_teste_uva_F1$p.value,t_teste_banana_F1$p.value,t_teste_laranja_F1$p.value,
  t_teste_uva_F2$p.value,t_teste_banana_F2$p.value,t_teste_laranja_F2$p.value,
  t_teste_uva_01_00$p.value,t_teste_banana_01_00$p.value,t_teste_laranja_01_00$p.value,
  t_teste_uva_01_11$p.value,t_teste_banana_01_11$p.value,t_teste_laranja_01_11$p.value,
  t_teste_uva_01_10$p.value,t_teste_banana_01_10$p.value,t_teste_laranja_01_10$p.value,
  t_teste_uva_00_11$p.value,t_teste_banana_00_11$p.value,t_teste_laranja_00_11$p.value,
  t_teste_uva_00_10$p.value,t_teste_banana_00_10$p.value,t_teste_laranja_00_10$p.value,
  t_teste_uva_11_10$p.value,t_teste_banana_11_10$p.value,t_teste_laranja_11_10$p.value)

Teste = c(
  rep("$\\bar{Y}_{F1=0} = \\bar{Y}_{F1=1}$",3),
  rep("$\\bar{Y}_{F2=0} = \\bar{Y}_{F2=1}$",3),
  rep("$\\bar{Y}_{F2=0,F1=1} = \\bar{Y}_{F1=0,F2=0}$",3),
  rep("$\\bar{Y}_{F2=0,F1=1} = \\bar{Y}_{F1=1,F2=1}$",3),
  rep("$\\bar{Y}_{F2=0,F1=1} = \\bar{Y}_{F1=1,F2=0}$",3),
  rep("$\\bar{Y}_{F2=0,F1=0} = \\bar{Y}_{F1=1,F2=1}$",3),
  rep("$\\bar{Y}_{F2=0,F1=0} = \\bar{Y}_{F1=1,F2=0}$",3),
  rep("$\\bar{Y}_{F2=1,F1=1} = \\bar{Y}_{F1=1,F2=0}$",3)
            
            )

tibble(Teste,
       `Fruta` = rep(c("uva","banana","laranja"),8),
       `P-Valor Teste de Bartlett`,
       `P-Valor T Test`) |> 
  mutate(padjustB = p.adjust(`P-Valor T Test`,method="bonferroni")) |> 
  mutate(padjustFDR = p.adjust(`P-Valor T Test`,method="fdr")) |> 
  kbl(format = "latex",escape = FALSE,booktabs = F,longtable = T) |> 
  kable_styling(font_size=6) |> 
  collapse_rows(columns = 1, valign = "middle",latex_hline = "major")
```


\pagebreak

2.5 - Da tabela MANOVA obtida em 1.3 construa a correspondente tabela MANOVA de um estudo que considera o efeito total dos 4 grupos definidos pela estrutura fatorial 2x2. Neste caso, seja $SS_{F}$ a Soma de Quadrados e Produtos Cruzados do referido fator em 4 níveis. Há efeito significante deste fator F que combina os níveis de F1 e F2?

R:

```{r}
pop_v2 <- pop |> 
  mutate(F1F2 = paste0(F1,F2)) |> 
  dplyr::select(-F1,-F2)

fit_v2 <- manova(as.matrix(pop_v2[,1:3]) ~ pop_v2$F1F2)

options(scipen=0)
fit_v2

fit_sum_p_v2 <- summary(fit_v2,test = "Pillai")
fit_sum_w_v2 <- summary(fit_v2,test = "Wilks")

tibble(` `=str_remove_all(fit_sum_p_v2$row.names,"pop_v2\\$")) |> 
  bind_cols(as_tibble(fit_sum_p_v2$stats))|> 
  as_tibble() |> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)

tibble(` `=str_remove_all(fit_sum_w_v2$row.names,"pop_v2\\$")) |> 
  bind_cols(as_tibble(fit_sum_w_v2$stats))|> 
  as_tibble() |> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)

options(scipen=999)
```

```{r Q2 V2 - MANOVA Stats}
SSF1F2_v2 <- fit_sum_p_v2$SS$`pop_v2$F1F2`
SSW_v2 <- fit_sum_p_v2$SS$Residuals
SSTotal_v2 <- SSF1F2 + SSW

# SSTotal <- (nrow(pop_v2)-1)*cov(pop_v2[,1:3])
```

Como os p-valores pelos teste de Wilks e Pillai para F são menores que o nível de significância de 5%. Rejeitamos a hipótese nula e concluímos que há diferença em ao menos um vetor médias de F.

```{r}
pop_v2 |> 
  group_by(F1F2) |> 
  dplyr::summarise(uva = mean(uva), banana = mean(banana), laranja = mean(laranja)) |> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```

Somas de Quadrados e Produtos Cruzados $SS_{F}$:
```{r}
SSF1F2_v2 |> 
  as_tibble()|> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```

Somas de Quadrados e Produtos Cruzados $SS_{W}$:
```{r}
SSW_v2 |> 
  as_tibble() |> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```

Somas de Quadrados e Produtos Cruzados $SS_{total}$:
```{r}
SSTotal_v2 |> 
  as_tibble() |> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```


2.6 - Obtenha a decomposição espectral (autovalores e autovetores) das seguintes matrizes: $SS_{W}^{-1}SS_{F1}, SS_{W}^{-1}SS_{F2}, SS_{W}^{-1}SS_{F1*F2}, SS_{W}^{-1}SS_{F}$. Qual é o padrão de contribuição das variáveis para cada um dos efeitos considerados?

R:

Autovalores e autovetores de $SS_{W}^{-1}SS_{F1}$

Ao avaliarmos a decomposição espectral da matriz $SS_{W}^{-1}SS_{F1}$ percebemos que a produção de uva, seguida da produção de banana (e por último produção de laranja), mais contribuem para a discriminação entre os efeitos dentro de F1, levando em conta a estrutura multivariada. 

```{r}
fit_sum_p$Eigenvalues |> 
  as_tibble() |> 
  slice(1) |> 
  setNames(c("uva","banana","laranja"))|>  
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)

eigen(solve(SSW)%*%SSF1)$vectors |> 
  as_tibble() |> 
  setNames(c("uva","banana","laranja"))|> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```


Autovetores de $SS_{W}^{-1}SS_{F2}$

Ao avaliarmos a decomposição espectral da matriz $SS_{W}^{-1}SS_{F2}$ percebemos que a produção de uva, seguida da produção de laranja (e por último produção de banana), mais contribuem para a discriminação entre os efeitos dentro de F1, levando em conta a estrutura multivariada. 

```{r}
fit_sum_p$Eigenvalues |> 
  as_tibble() |> 
  slice(2) |> 
  setNames(c("uva","banana","laranja"))|>  
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)

eigen(solve(SSW)%*%SSF2)$vectors|> 
  as_tibble()|> 
  setNames(c("uva","banana","laranja"))|> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```

Autovetores de $SS_{W}^{-1}SS_{F1*F2}$

Ao avaliarmos a decomposição espectral da matriz $SS_{W}^{-1}SS_{F1*F2}$ percebemos que a produção de uva, seguida da produção de laranja (e por último produção de banana), mais contribuem para a discriminação entre os efeitos dentro da interação de F1 e F2, levando em conta a estrutura multivariada. 

```{r}
fit_sum_p$Eigenvalues |> 
  as_tibble() |> 
  slice(3) |> 
  setNames(c("uva","banana","laranja"))|>  
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)

eigen(solve(SSW)%*%SSF1F2)$vectors |> 
  as_tibble()|> 
  setNames(c("uva","banana","laranja"))|> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```

Autovetores de $SS_{W}^{-1}SS_{F}$
```{r}
eigen(solve(SSW)%*%SSB)$vectors |> 
  as_tibble() |> 
  setNames(c("uva","banana","laranja"))|> 
  kbl(format = "latex",escape = FALSE,booktabs = TRUE,longtable = T) |> 
  kable_styling(font_size=6)
```





