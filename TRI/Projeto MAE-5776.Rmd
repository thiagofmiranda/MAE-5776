---
title: "Análise da gestão ambiental de municípios brasileiros pela Teoria da Resposta ao Item"
output:
  pdf_document:
    latex_engine: lualatex
    pandoc_args: --listings
    includes:
      in_header: preamble.tex
geometry: columnsep=3em
---


```{r setup, include=FALSE}
def.chunk.hook  <- knitr::knit_hooks$get("chunk")
knitr::knit_hooks$set(chunk = function(x, options) {
  x <- def.chunk.hook(x, options)
  ifelse(options$size != "normalsize", paste0("\n \\", options$size,"\n\n", x, "\n\n \\normalsize"), x)
})
knitr::opts_chunk$set(
  echo = FALSE,
  warning=FALSE,
  message=FALSE, 
  comment=">",
  prompt=T,
  fig.align='center',
  size="small")


options(
  scipen=999,
  knitr.kable.NA = '',
  knitr.table.bottomrule = "\\specialrule{.3pt}{0pt}{1pt}\\specialrule{.3pt}{0pt}{0pt}",
  knitr.table.toprule    = "\\specialrule{.3pt}{0pt}{1pt}\\specialrule{.3pt}{0pt}{0pt}",
  knitr.table.midrule    = "\\specialrule{.3pt}{0pt}{1pt}")


if(!require(kableExtra)) install.packages("kableExtra"); library(kableExtra)
if(!require(readxl)) install.packages("readxl"); library(readxl)
if(!require(formatR)) install.packages("formatR"); library(formatR)
if(!require(xtable)) install.packages("xtable"); library(xtable)
if(!require(tidyverse)) install.packages("tidyverse"); library(tidyverse)
if(!require(factoextra)) install.packages("factoextra"); library(factoextra)
if(!require(RColorBrewer)) install.packages("RColorBrewer"); library(RColorBrewer)
if(!require(ggpubr)) install.packages("ggpubr"); library(ggpubr)
if(!require(irtoys)) install.packages("irtoys"); library(irtoys)


# Funções

# função para converter uma matrix em tex
texMatrix <- function(matrix, round = 2){
  matrix <- round(matrix,round)
  tex <- ""
  for(i in 1:nrow(matrix)){
    if(i != nrow(matrix)){
      tex <- paste0(tex,paste(matrix[i,],collapse = " & ")," \\\\ ")
    }else{
      tex <- paste0(tex,paste(matrix[i,],collapse = " & "))
    }
    
  }
  
  paste0("\\begin{pmatrix}",tex,"\\end{pmatrix}")
}
```

```{r}
load("data.RData")
```

**Alunos:**

Leandro Alves da Silva - nº USP: 11868023

Thiago Ferreira Miranda - nº USP: 11925711

\section{Introdução}


Segundo Anjos e Andrade (2012) diversos pesquisadores em diferentes áreas de atuação têm direcionado esforço na busca da identificação de características que possam estar presentes em indíviduos, mas não podem ser medidas diretamente (sendo estas variáveis não observadas), as quais são comumente denominadas de traço latente, e assim desenvolver de índices, escalas apropriadas para seu enquadramento. Alguns exemplos de tais características são: nível de qualidade de vida, proficiência em matemática, grau de depressão, dentre outros.

Neste tocante, duas teorias são apresentadas, a Teoria Clássica dos Testes
– TCT, que utiliza o escore no teste como sua referência de medida, e a Teoria da Resposta ao Item – TRI, cujo foco principal é o item e não o teste como um todo. Tanto a TCT quanto a TRI são análises paramétricas, ou seja, a análise de itens é efetuada por meio
das estimativas de seus parâmetros e do instrumento de medida como um todo.
A TRI foi desenvolvida com o propósito de resolver um problema
da TCT que é a dependência da medida de proficiência em relação ao teste
aplicado e dos parâmetros dos itens em relação ao conjunto dos respondentes. O que não ocorre na TRI, pois seus parâmetros (de discriminação e de dificuldade do item) não dependem do grupo de respondentes, bem como há depedência da medida de proficiência de um aluno com relação aos itens apresentados a ele. Portanto, um
item mede determinado conhecimento, independentemente de quem o está
respondendo, e a proficiência de um aluno não depende dos itens que estão sendo apresentados a ele.

Maiores detalhes sobre estas duas teorias podem ser encontrados em: Gulliksen
(1950), Lord e Novick (1968), Lord (1980), Vianna (1987), Pasquali
(2003), Andrade, Tavares e Valle (2000), Ayala (2009), Baker e Kim (2004) e
Embretson e Reise (2000).

Este trabalho tem como objetivo aplicar a teoria da resposta ao item em um caso real, para isso foi utilizado a seção de meio ambiente da Pesquisa de Informações Básicas Municipais - MUNIC e proposta a criação de um indicador para a gestão ambiental municipal por meio da teoria da resposta ao item.


\subsection{Teoria clássica dos testes: parâmetros}


\subsubsection{Coeficiente de correlação ponto-bisserial}

O coeficiente de correlação ponto-bisserial ($\rho_{pb}$) é a correlação de Pearson entre uma variável dicotômica e o escore do teste e é definido por:

\begin{equation}
\rho_{pb} = \frac{\overline{X}_A - \overline{X}_T}{S_T}\sqrt{\frac{p}{1-p}}
\end{equation}

em que,

$\overline{X}_A$ é a média dos escores dos respondentes que acertaram o item;

$\overline{X}_T$ é a média global dos escores do teste;

$S_T$ é o desvio padrão do teste;

$p$ é a proporção de respondentes que acertaram o item.


\subsubsection{Coeficiente de correlação bisserial}

O coeficiente de correlação bisserial ($\rho_{b}$) é uma medida de associação entre uma variável dicotomizada e uma variável contínua, e é definido por:

\begin{equation}
\rho_{b} = \rho_{pb}\frac{\sqrt{p(1-p)}}{h(p)}
\end{equation}

em que,

$\rho_{pb}$ é a correlação ponto-bisserial;

$p$ é a proporção de respondentes que acertaram o item;

$h(p)$ é o valor da densidade da distribuição normal padrão no ponto em que a área da curva à esquerda deste ponto é igual a $p$.

\vspace{0.5cm}
\textbf{Nota: Neste trabalho o coeficiente de correlação bisserial não será avaliado.}


\subsubsection{Coeficiente alfa de Cronbach}

O coeficiente alfa de Cronbach é utilizado para medir a consistência interna do instrumento de medida, e é definido por:

\begin{equation}
    \alpha = \frac{n}{n-1}\Big(1 -  \frac{\sum{s_{i}^{2}}}{s_{T}^{2}}\Big)
\end{equation}

em que,

$n$ é o númenro de itens;

$\sum{s_{i}^{2}}$ é soma das variâncias dos $n$ itens;

$s_{T}^{2}$ é a variância global dos escores dos testes.

Esse coeficiente varia de 0 a 1. Quanto mais próximo de 0 menor a consistência e quanto mais próximo de 1 maior a consistência do teste.


\subsection{Teoria da Resposta ao Item}

A Teoria da Resposta ao Item possui modelos vários modelos propostos na literatura, neste trabalho serão abordados os modelos logísticos unidimensionais da TRI.
De acordo com Andrade (2000), os modelos logísticos para itens dicotômicos são os modelos de resposta ao item mais utilizados, os quais são referidos por os modelos logísticos de 1, 2 e 3 parâmetros, que consideram, respectivamente:

\begin{itemize}
    \item somente a dificuldade do item;
    \item a dificuldade e a discriminação;
    \item a dificuldade, a discriminação e a probabilidade de resposta correta dada por indivíduos de baixa habilidade.
\end{itemize}


\subsubsection{Modelo de 3 parâmetros}

O modelo logístico de 3 parâmetros é definido por:

\begin{equation}
    P(U_{ij} = 1|\theta_j, a_i, b_i, c_i) = c_i + (1-c_i)\frac{e^{a_i(\theta_j - b_i)}}{1 + e^{a_i(\theta_j - b_i)}}
\end{equation}

em que,

$P(U_{ij} = 1|\theta_j, a_i, b_i, c_i)$ é a probabilidade do indivíduo $j$ com habilidade $\theta_j$ acertar o item $i$;

$b_i$ é o parâmetro de dificuldade (ou de posição) do item $i$, medido na mesma escala de habilidade;

$a_i$ é o parâmetro de discriminação (ou inclinação) do item $i$, com valor proporcional à inclinação da Curva Característica do Item no ponto $b_i$;

$c_i$ é o parâmetro do item que representa a probabilidade de indivíduos com baixa habilidade responderem corretamente o item $i$ (também chamado de probabilidade de acerto casual).



\subsubsection{Modelo de 2 parâmetros}

O modelo logístico de 2 parâmetros é semelhante ao modelo de 3 parâmetros, mas não inclui o parâmetro de acerto casual no modelo.

\begin{equation}
    P(U_{ij} = 1|\theta_j, a_i, b_i) = \frac{e^{a_i(\theta_j - b_i)}}{1 + e^{a_i(\theta_j - b_i)}}
\end{equation}



\subsubsection{Função de informação do item}

A função de informação do item (item information function) permite analisar
o quanto um item contém de informação sobre a medida de habilidade.
Ela indica a quantidade de informação que um item apresenta dentro da escala
de habilidade. 

Para o modelo logístico de 2 parâmetros a função de informação do item é definida como:

\begin{equation}
    I_i(\theta) = a_{i}^{2}P_i(\theta)(Q_i(\theta))
\end{equation}

em que,

$I_i(\theta)$ é a informação fornecida pelo item $i$ no nível de habilidade $\theta$;

$P_i(\theta) = P(X_{ij} = 1|\theta)$;

$Q_i(\theta) = 1-P_i(\theta)$;

$a_i$ é o parâmetro de discriminação (ou inclinação) do item $i$.


\subsubsection{Função de informação do teste}

Dada a independência entre os itens, a função de informação do teste (teste
information function) é a soma das informações fornecidas por cada item, que foram calibrados em uma mesma escala. A função de informação do teste é
escrita como:

\begin{equation}
    I(\theta) = \displaystyle\sum_{i=1}^{I}{I_i(\theta)}
\end{equation}

\subsubsection{Métodos de estimação}


\section{Aplicação da TRI}

\subsection{Pesquisa de Informações Básicas Municipais - MUNIC}

A Pesquisa de Informações Básicas Municipais é realizada pelo Instituto Brasileiro de Geografia e Estatística - IBGE desde 1999 e, conforme publicado em seu livro, trata-se de pesquisa institucional e de registros administrativos da gestão pública municipal. O principal interesse da Munic é a gestão pública na esfera de administração, no que se refere à organização das prefeituras, bem como o quadro funcional, estrutura e políticas públicas setoriais no âmbito das áreas pesquisadas. Em 2020, a pesquisa investigou informações sobre recursos humanos, habitação, transporte, agropecuária, meio ambiente, gestão de riscos e de desastres, e COVID-19. O questionário de meio ambiente é dividido nas seguintes seções:

\newpage

1. Órgão gestor do meio ambiente;
2. Recursos humanos na área do meio ambiente por vínculo e capacitação;
3. Conselho e Fundo municipal de Meio Ambiente;
4. Legislação ou instrumento de gestão ambiental;
6. Plano de Gestão Integrada de Resíduos Sólidos;
7. Programas em parceria com o Governo Federal;
8. Pagamento de Serviços Ambientais;
9. Impacto Ambiental e/ou processo/ação que resulte em impacto no ambiente.




Composto pelo seguintes itens em cada seção:

```{r}
dicionario |> 
  filter(secao.id=="5.1") |> 
  dplyr::select(-c(1,2)) |> 
  kbl(format = "latex",escape = FALSE,booktabs = F,longtable = T,linesep="",
      caption = "Órgão gestor do meio ambiente.") |> 
  kable_styling(font_size=5)
```



```{r}
dicionario |> 
  filter(secao.id=="5.2") |> 
  dplyr::select(-c(1,2)) |> 
  kbl(format = "latex",escape = FALSE,booktabs = F,longtable = T,linesep="",
      caption = "Capacitação.") |> 
  kable_styling(font_size=5) |> 
  column_spec(2, width = "50em")
```

\newpage

```{r}
dicionario |> 
  filter(secao.id=="5.3") |> 
  dplyr::select(-c(1,2)) |> 
  kbl(format = "latex",escape = FALSE,booktabs = F,longtable = T,linesep="",
      caption = "Conselho e Fundo municipal de meio ambiente.") |> 
  kable_styling(font_size=5) |> 
  column_spec(2, width = "50em")
```



```{r}
dicionario |> 
  filter(secao.id=="5.4") |> 
  dplyr::select(-c(1,2)) |> 
  kbl(format = "latex",escape = FALSE,booktabs = F,longtable = T,linesep="",
      caption = "Legislação ou instrumento de gestão ambiental.") |> 
  kable_styling(font_size=5)

dicionario |> 
  filter(secao.id=="5.6") |> 
  dplyr::select(-c(1,2)) |> 
  kbl(format = "latex",escape = FALSE,booktabs = F,longtable = T,linesep="",
      caption = "Plano de Gestão Integrada de Resíduos Sólidos.") |> 
  kable_styling(font_size=5) |> 
  column_spec(2, width = "50em")

dicionario |> 
  filter(secao.id=="5.7") |> 
  dplyr::select(-c(1,2)) |> 
  kbl(format = "latex",escape = FALSE,booktabs = F,longtable = T,linesep="",
      caption = "Programas em parceria com o Governo Federal.") |> 
  kable_styling(font_size=5) |> 
  column_spec(2, width = "50em")
```



```{r anexos 3}
dicionario |> 
  filter(secao.id=="5.8") |> 
  dplyr::select(-c(1,2)) |> 
  kbl(format = "latex",escape = FALSE,booktabs = F,longtable = T,linesep="",
      caption = "Pagamento de Serviços Ambientais.") |> 
  kable_styling(font_size=5) |> 
  column_spec(2, width = "50em")

dicionario |> 
  filter(secao.id=="5.9") |> 
  dplyr::select(-c(1,2)) |> 
  kbl(format = "latex",escape = FALSE,booktabs = F,longtable = T,linesep="",
      caption = "Impacto Ambiental e/ou processo/ação que resulte em impacto no ambiente.") |> 
  kable_styling(font_size=5) |> 
  column_spec(2, width = "50em")

```

\newpage

\subsection{Avaliação dos itens pela TCT}

Para uma avaliação inicial dos dos itens quem compõem o teste e também do questionário com um todo, realizou-se a análise via teoria classica dos testes para fazer a checagem do instrumento de avaliação, onde verificou-se o coeficiente de correlação ponto-bisserial e o alpha de cronbach. Nessa avaliação, itens podem ser removidos da análise TRI por terem coeficiente de correlação ponto-bisserial baixo, indicando uma baixa correlação entre as respostas do item em relação ao escore do teste (TCT), e por terem alpha de cronbach alto quando excluímos o item, indicando que a exclusão dele aumentaria a consistência do teste. Entretanto, para a análise pela TRI, não removeu-se nenhum item.

Na análise pela TRI rodamos o modelo logístico unidimensional de 2 parâmetros, na planilha estão presentes tanto os parâmetros, quanto os escores gerados. Há também plots relacionados ao teste e a cada um dos itens. No R usamos o pacote irtoys para ambas as análises.



```{r Análise Clássica 1, echo = FALSE, results = 'asis', warning = F}
# Análise por scores
tct_1 <- data.frame(tct$perc) |> 
  rename(prop0=X0,prop1=X1) |> 
  mutate(bisCorr=tct$bisCorr) |> 
  mutate(ExBisCorr=tct$ExBisCorr) 

t1.1 <- tct_1[1:30,] 

t1.1 <- t1.1 |>
  round(2)|>
  kbl(format = "latex",linesep="")

t1.2 <- tct_1[31:60,] 

t1.2 <- t1.2 |>
  round(2) |> 
  kbl(format = "latex",linesep="") 

cat(c("\\begin{table}[h] \\caption{TCT - Proporção de resposta por nível e coeficientes de correlação ponto bisserial.} \\centering \\tiny", 
      t1.1,
    "\\hspace{0cm} \\centering ",
      t1.2,
    "\\end{table}"))
```

\newpage

```{r Análise Clássica 2, echo = FALSE, results = 'asis', warning = F}
tct_2 <- data.frame(alpha=tct$alpha) |> 
  round(4)


t2.1 <- tct_2 |> 
  slice(1:30) 

t2.1 <- t2.1 |>
  rename(alpha=value) |> 
  kbl(format = "latex",linesep="")

t2.2 <- tct_2|> 
  slice(31:60) 

t2.2 <- t2.2 |>
  rename(alpha=value) |> 
  kbl(format = "latex",linesep="") 

cat(c("\\begin{table}[h] \\caption{TCT - Alpha de Cronbach.} \\centering \\tiny", 
      t2.1,
    "\\hspace{0cm} \\centering ",
      t2.2,
    "\\end{table}"))
```

\newpage

\subsection{Calibração dos parâmetros dos itens}

```{r Análise TRI, fig.width=6,fig.height=3}
data.frame(itens_parametros_3$est) |> 
  setNames(c("a","b","c")) |> 
  rownames_to_column("item.id") |> 
  right_join(itens_selecionados,by="item.id") |> 
  dplyr::select(item.id,item.descricao,a,b)|> 
  filter(!is.na(a)) |> 
  kbl(format = "latex",escape = FALSE,booktabs = F,longtable = T,linesep="",align=c("l","l","c","c"),caption = "Itens que permaneceram na análise.") |> 
  kable_styling(font_size=5) |> 
  column_spec(2, width = "50em")
```

\newpage

\subsection{Estimação dos escores dos municípios}

```{r Análise TRI 2,,out.width = '80%', fig.height=6,fig.width=12,fig.cap="Distribuição dos escores."}
ggarrange(gghistogram(escores[,1],binwidth = 0.2),ggqqplot(escores[,1]))


```

\newpage









































